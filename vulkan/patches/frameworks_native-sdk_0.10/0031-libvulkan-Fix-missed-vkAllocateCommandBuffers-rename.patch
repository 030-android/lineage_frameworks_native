From 3b8513e831673417af2ad79baa6c73710742fa0f Mon Sep 17 00:00:00 2001
From: Jesse Hall <jessehall@google.com>
Date: Wed, 2 Dec 2015 15:40:12 -0800
Subject: [PATCH] libvulkan: Fix missed vkAllocateCommandBuffers renames

Change-Id: Ic3fee0d565009327f524084b14da498c8412155f
---
 vulkan/libvulkan/entry.cpp      |  2 +-
 vulkan/libvulkan/entry.cpp.tmpl |  2 +-
 vulkan/libvulkan/loader.cpp     | 10 +++++-----
 vulkan/libvulkan/loader.h       |  6 +++---
 4 files changed, 10 insertions(+), 10 deletions(-)

diff --git a/vulkan/libvulkan/entry.cpp b/vulkan/libvulkan/entry.cpp
index 9c0444f..77dceef 100644
--- a/vulkan/libvulkan/entry.cpp
+++ b/vulkan/libvulkan/entry.cpp
@@ -483,7 +483,7 @@ VKAPI_ATTR VkResult vkResetCommandPool(VkDevice device, VkCommandPool commandPoo
 
 __attribute__((visibility("default")))
 VKAPI_ATTR VkResult vkAllocateCommandBuffers(VkDevice device, const VkCommandBufferAllocateInfo* pAllocateInfo, VkCommandBuffer* pCommandBuffers) {
-    return GetVtbl(device).AllocateCommandBuffers(device, pAllocateInfo, pCommandBuffers);
+    return vulkan::AllocateCommandBuffers(device, pAllocateInfo, pCommandBuffers);
 }
 
 __attribute__((visibility("default")))
diff --git a/vulkan/libvulkan/entry.cpp.tmpl b/vulkan/libvulkan/entry.cpp.tmpl
index 5047741..c11b232 100644
--- a/vulkan/libvulkan/entry.cpp.tmpl
+++ b/vulkan/libvulkan/entry.cpp.tmpl
@@ -109,7 +109,7 @@ namespace {
 */}}
 {{define "IsSpecialEntry"}}
   {{/* TODO: figure out how to do this in a cleaner or at least multi-line way */}}
-  {{if or (eq $ "vkGetInstanceProcAddr") (or (eq $ "vkGetDeviceProcAddr") (or (eq $ "vkGetDeviceQueue") (or (eq $ "vkCreateCommandBuffer") (eq $ "vkDestroyDevice"))))}}
+  {{if or (eq $ "vkGetInstanceProcAddr") (or (eq $ "vkGetDeviceProcAddr") (or (eq $ "vkGetDeviceQueue") (or (eq $ "vkAllocateCommandBuffers") (eq $ "vkDestroyDevice"))))}}
     true
   {{end}}
 {{end}}
diff --git a/vulkan/libvulkan/loader.cpp b/vulkan/libvulkan/loader.cpp
index 2d45558..defd691 100644
--- a/vulkan/libvulkan/loader.cpp
+++ b/vulkan/libvulkan/loader.cpp
@@ -1121,8 +1121,8 @@ PFN_vkVoidFunction GetDeviceProcAddr(VkDevice device, const char* name) {
     if (strcmp(name, "vkGetDeviceQueue") == 0) {
         return reinterpret_cast<PFN_vkVoidFunction>(GetDeviceQueue);
     }
-    if (strcmp(name, "vkAllocCommandBuffers") == 0) {
-        return reinterpret_cast<PFN_vkVoidFunction>(AllocCommandBuffers);
+    if (strcmp(name, "vkAllocateCommandBuffers") == 0) {
+        return reinterpret_cast<PFN_vkVoidFunction>(AllocateCommandBuffers);
     }
     if (strcmp(name, "vkDestroyDevice") == 0) {
         return reinterpret_cast<PFN_vkVoidFunction>(DestroyDevice);
@@ -1146,9 +1146,9 @@ void GetDeviceQueue(VkDevice drv_device,
     *out_queue = queue;
 }
 
-VkResult AllocCommandBuffers(VkDevice device,
-                             const VkCommandBufferAllocateInfo* alloc_info,
-                             VkCommandBuffer* cmdbufs) {
+VkResult AllocateCommandBuffers(VkDevice device,
+                                const VkCommandBufferAllocateInfo* alloc_info,
+                                VkCommandBuffer* cmdbufs) {
     const DeviceVtbl* vtbl = GetVtbl(device);
     VkResult result = vtbl->AllocateCommandBuffers(device, alloc_info, cmdbufs);
     if (result != VK_SUCCESS)
diff --git a/vulkan/libvulkan/loader.h b/vulkan/libvulkan/loader.h
index 1f777fc..e007f8d 100644
--- a/vulkan/libvulkan/loader.h
+++ b/vulkan/libvulkan/loader.h
@@ -220,9 +220,9 @@ void GetDeviceQueue(VkDevice drv_device,
                     uint32_t family,
                     uint32_t index,
                     VkQueue* out_queue);
-VkResult AllocCommandBuffers(VkDevice device,
-                             const VkCommandBufferAllocateInfo* alloc_info,
-                             VkCommandBuffer* cmdbufs);
+VkResult AllocateCommandBuffers(VkDevice device,
+                                const VkCommandBufferAllocateInfo* alloc_info,
+                                VkCommandBuffer* cmdbufs);
 VkResult DestroyDevice(VkDevice drv_device,
                        const VkAllocationCallbacks* allocator);
 
-- 
2.6.0.rc2.230.g3dd15c0

